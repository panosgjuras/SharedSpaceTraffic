geom_line(aes(x = 1:nrow(subset(df, case==street)), y = dspeed, color = 'Deviation from mean traffic speed'), size=0.75, linetype='solid') +
# geom_line(aes(x = 1:nrow(subset(df, case==street)), y = comply*20-0.25, color = 'Deviation from speed limit'), size=0.6) +
geom_line(aes(x = 1:nrow(subset(df, case==street)), y = (pedcross*20) - 6, color = 'Crossings per pedestrian'), size=0.75) +
scale_color_manual(name = '', values = c('Deviation from mean traffic speed'='red',
#'Deviation from speed limit'='black',
'Crossings per pedestrian'='blue2')) +
scale_x_continuous(name = 'Two minutes intervals', limits = c(0,105), breaks=seq(0,nrow(subset(df, case==street)),5)) +
scale_y_continuous(name = 'Speed deviations in km/h', limits = c(-25,25),
sec.axis = sec_axis( trans=~ (./20) + 0.3, name="Pedestrian crossing rate")) +
ggtitle(text) + theme_bw() + theme(legend.position="bottom")
return(p)}
timeplot2<-function(df,street,text){ # time series plot, relationship between dspeed, lspeed, pedcross
p<-ggplot(subset(df, case==street)) +
# geom_line(aes(x = 1:nrow(subset(df, case==street)), y = dspeed, color = 'Deviation from mean traffic speed'), size=0.75, linetype='solid') +
geom_line(aes(x = 1:nrow(subset(df, case==street)), y = comply, color = 'Compliance rate'), size=0.75) +
geom_line(aes(x = 1:nrow(subset(df, case==street)), y = pedcross + 0.5, color = 'Crossings per pedestrian'), size=0.75) +
scale_color_manual(name = '', values = c('Compliance rate'='green',
'Crossings per pedestrian'='blue2')) +
scale_x_continuous(name = 'Two minutes intervals', breaks=seq(0,nrow(subset(df, case==street)),5)) +
scale_y_continuous(name = 'Compliance rate', limits = c(0,2),
sec.axis = sec_axis( trans=~ . - 0.5, name="Pedestrian crossing rate")) +
ggtitle(text) + theme_bw() + theme(legend.position="bottom")
return(p)}
ggarrange(timeplot(traf,'fsbr','Frankfurter Stra?e, Bad Rothenfelde, Germany'),
timeplot(traf,'lsho','Lange Stra?e, Hessisch Oldendorf, Germany'),
timeplot(traf,'mke','Marktplatz, K?nigslutter am Elm, Germany'),
timeplot(traf,'shnaf','Amalias Street, Nafplio, Greece'), ncol=1, nrow=4,
common.legend = TRUE, legend="bottom")
ggarrange(timeplot2(traf,'fsbr','Frankfurter Stra?e, Bad Rothenfelde, Germany'),
timeplot2(traf,'lsho','Lange Stra?e, Hessisch Oldendorf, Germany'),
timeplot2(traf,'mke','Marktplatz, K?nigslutter am Elm, Germany'),
timeplot2(traf,'shnaf','Amalias Street, Nafplio, Greece'), ncol=1, nrow=4,
common.legend = TRUE, legend="bottom")
ggarrange(timeplot(traf,'fsbr','Frankfurter Stra?e, Bad Rothenfelde, Germany'),
timeplot(traf,'lsho','Lange Stra?e, Hessisch Oldendorf, Germany'),
timeplot(traf,'mke','Marktplatz, K?nigslutter am Elm, Germany'),
timeplot(traf,'shnaf','Amalias Street, Nafplio, Greece'), ncol=1, nrow=4,
common.legend = TRUE, legend="bottom")
ggarrange(timeplot(traf,'fsbr','Frankfurter Street, Bad Rothenfelde, Germany'),
timeplot(traf,'lsho','Lange Street, Hessisch Oldendorf, Germany'),
timeplot(traf,'mke','Marktplatz, K?nigslutter am Elm, Germany'),
timeplot(traf,'shnaf','Amalias Street, Nafplio, Greece'), ncol=1, nrow=4,
common.legend = TRUE, legend="bottom")
# Simulation of these models: model88 and model77
pedcross <- function(dped, dflow, s_saf, s_act){
b0 = model77[["coefficients"]][["(Intercept)"]]
b1 = model77[["coefficients"]][["dflow"]]
b2 = model77[["coefficients"]][["dped"]]
b3 = model77[["coefficients"]][["shmaxact"]]
b4 = model77[["coefficients"]][["shminsafe"]]
pedcross <- -log(b0 + b1 * dflow + b2 * dped + b3 * s_act + b4 * s_saf)
return(pedcross)}
comply<-function(dped, dflow, s_saf, s_act){
b0 = model88[["coefficients"]][["(Intercept)"]]
b1 = model88[["coefficients"]][["dflow"]]
b2 = model88[["coefficients"]][["dped"]]
b3 = model88[["coefficients"]][["shmaxact"]]
b4 = model88[["coefficients"]][["shminsafe"]]
comply <- b0 + b1 * dflow + b2 * dped + b3 * s_act + b4 * s_saf
return(comply)}
simu<-function(x, y, circ, saf, act, name){
df <- data.frame(dped = x, dflow = y)
df['s_circ']<-circ/15
df['s_saf']<-saf/15
df['s_act']<-act/15
df["cross"] <- name
df["comply_veh"]<- comply(0, df$dflow, df$s_saf, df$s_act)
df["pedcross_veh"]<-pedcross(0, df$dflow, df$s_saf, df$s_act)
df["comply_ped"]<- comply(df$dped, 0, df$s_saf, df$s_act)
df["pedcross_ped"]<-pedcross(df$dped, 0, df$s_saf, df$s_act)
df["comply"]<- comply(df$dped, df$dflow, df$s_saf, df$s_act)
df["pedcross"]<-pedcross(df$dped, df$dped, df$s_saf, df$s_act)
return(df)}
x = seq(-625, 625, by = 10) # the less, the more
y = seq(625, -625, by = -10) # the more, the less
# scenario simualtion
pldf2<-simu(x, y, 0, 0, 15, 's1: circ: 0%; saf: 0%; act: 100%')
pldf2<-rbind(pldf2, simu(x, y, 3, 3, 9, 's2: circ: 20%; saf: 20%; act: 60%'))
pldf2<-rbind(pldf2, simu(x, y, 4.5, 4.5, 6, 's3: circ: 30%; saf: 30%; act: 40%'))
pldf2<-rbind(pldf2, simu(x, y, 6, 6, 3, 's4: circ: 40%; saf: 40%; act: 20%'))
pldf2<-rbind(pldf2, simu(x, y, 7.5, 7.5, 0, 's5: circ: 50%; saf: 50%; act: 0%'))
pldf2<-rbind(pldf2, simu(x, y, 0, 15, 0, 's6: circ: 0%; saf: 100%; act: 0%'))
pldf2<-rbind(pldf2, simu(x, y, 3, 9, 3, 's7: circ: 20%; saf: 60%; act: 20%'))
pldf2<-rbind(pldf2, simu(x, y, 6, 4.5, 4.5, 's8: circ: 40%; saf: 30%; act: 30%'))
pldf2<-rbind(pldf2, simu(x, y, 9, 3, 3, 's9: circ: 60%; saf: 20%; act: 60%'))
pldf2<-rbind(pldf2, simu(x, y, 15, 0, 0, 's99: circ: 100%; saf: 0%; act: 0%'))
ggplot(pldf2, aes(x = dflow, y = as.factor(cross))) + geom_raster(aes(fill = pedcross)) + theme_bw() +
theme(axis.text.y = element_text(size = 11.5)) +
scale_y_discrete(name = "") + theme(legend.position="bottom") +
scale_x_continuous(name = "Deviation of vehicle flow in veh/h") +
scale_fill_viridis_c("Pedestrian crossing rate", option = "D", direction = 1)
ggplot(pldf2, aes(x = dped, y = as.factor(cross))) + geom_raster(aes(fill = comply)) + theme_bw() +
theme(axis.text.y = element_text(size = 11.5)) +
scale_y_discrete(name = "", position = "right") + theme(legend.position="bottom") +
scale_x_continuous(name = "Deviation of pedestrian flow in peds/h") +
scale_fill_viridis_c("Speed compliance rate", option = "B", direction = 1)
# HOT HOT HOT HOT FINALLY
traf$pedcross2<-1/exp(traf$pedcross)
model77<-lm(pedcross2 ~ dflow + dped + shmaxact + shminsafe, data = traf[-c(228, 226, 196, 70, 31, 59, 46),])
summary(model77)
ols_vif_tol(model77)
gvlma(model77)
summary(model77)
summary(model88)
ggplot(pldf2, aes(x = dflow, y = as.factor(cross))) + geom_raster(aes(fill = pedcross)) + theme_bw() +
theme(axis.text.y = element_text(size = 11.5)) +
scale_y_discrete(name = "") + theme(legend.position="bottom") +
scale_x_continuous(name = "Deviation of vehicle flow in veh/h") +
scale_fill_viridis_c("Pedestrian crossing rate", option = "D", direction = 1)
library(ggplot2)
library(ggpubr)
library(corrplot)
library(gvlma)
library(olsrr)
library(RColorBrewer)
library(psych)
library(dplyr)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
gerdat<-read.csv2('datasets/datasets_germany_DESIGN.csv', header=T, dec=".", sep=",")
eldat<-read.csv2('datasets/amalias_traffic_dataset_DESIGN.csv', header=T, dec=".", sep=",")
#
# NEW DATASET TO PLAY WITH
datafr_fun <- function(df, x, dats, limit){
if(dats == 'dats1'){datafr<-data.frame(case=x, flow=30*subset(df, case==x)$n_cars + 30*subset(df, case==x)$n_cyclists,
dflow = 30*subset(df, case==x)$n_cars + 30*subset(df, case==x)$n_cyclists -
mean(30*subset(df, case==x)$n_cars + 30*subset(df, case==x)$n_cyclists),
# all vehicles in veh/h, no pcu was used...
# cyclists cannot be considered separately
# since no cyclists recorded in Nafplio, Greece
speed = subset(df, case==x)$mean_car_speed,
dspeed = subset(df, case==x)$mean_car_speed - mean(subset(df, case==x)$mean_car_speed),
# deviation from the mean speed.
lspeed = subset(df, case==x)$mean_car_speed - limit,
# difference from the speed limit, compliance of drivers
comply = subset(df, case==x)$mean_car_speed/limit,
ped = 30*subset(df, case==x)$n_pedestrians,
dped = 30*subset(df, case==x)$n_pedestrians - mean(30*subset(df, case==x)$n_pedestrians),
# flow of pedestrians per hour
dcross = 30*subset(df, case==x)$ped_crossing - mean(30*subset(df, case==x)$ped_crossing),
cross = 30*subset(df, case==x)$ped_crossing)}
if(dats == 'dats2'){datafr<-data.frame(case=x, flow=60/subset(df, case==x)$headway,
dflow = (60/subset(df, case==x)$headway) - mean(60/subset(df, case==x)$headway),
# calculation flows from headways
speed = subset(df, case==x)$speed,
dspeed = subset(df, case==x)$speed - mean(subset(df, case==x)$speed),
lspeed = subset(df, case==x)$speed - limit, # there is no speed limit, suppose 30
comply = subset(df, case==x)$speed/limit,
ped = 30*subset(df, case==x)$ped,
dped = 30*subset(df, case==x)$ped - mean(30*subset(df, case==x)$ped),
dcross = 30*subset(df, case==x)$cross - mean(30*subset(df, case==x)$cross),
cross = 30*subset(df, case==x)$cross)}
datafr<-cbind(datafr, data.frame(shared = subset(df, case==x)$shared,
# 1, if shared space, only one section
oneway = subset(df, case==x)$oneway,
lanes = subset(df, case==x)$lanes,
# 1, if oneway road
# park = subset(df, case==x)$park, # no use, all section with parking
mark = subset(df, case==x)$mark,
# 1, if road markings
trees = subset(df, case==x)$trees,
# 1, if trees
bollards = subset(df, case==x)$bollards,
# 1, if bollards
width = subset(df, case==x)$width,
# width of the pavement
cross_y = subset(df, case==x)$cross_y,
# 1, existence of courtesy crossings
s_width = subset(df, case==x)$s_width,
# 1, sidewalk width
# inters = subset(df, case==x)$inters, no use of this variable
bench = subset(df, case==x)$bench,
# 1, if benches
obst = subset(df, case==x)$obst,
# 1, if obstacles
lev_segr = subset(df, case==x)$lev_segr),
vis_segr = subset(df, case==x)$vis_segr) # 1, if level segregatioN
return(datafr)}
traf<-datafr_fun(gerdat,'fsbr', 'dats1', 20) # fsbr 20 km/h
traf<-rbind(traf, datafr_fun(gerdat,'lsho', 'dats1', 10)) # 10 km/h
traf<-rbind(traf, datafr_fun(gerdat,'mke', 'dats1', 20)) # 20 km/h
traf<-rbind(traf, datafr_fun(eldat,'shnaf','dats2', 30)) # # 30 km/h
traf$comply<-replace(traf$comply, traf$comply==0, 1)
corr(select(traf, c('shcirc', 'shmaxact', 'shminsafe',
'dflow', 'dped', 'dspeed', 'pedcross', 'comply')), 0.95, 'kendall')
p11<-ggplot(traf, aes(x=as.factor(case), y = pedcross, fill=case)) + geom_boxplot() +
geom_point(size = 0.9, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_x_discrete(name = 'Case', labels = c('Frankfurter Str', 'Lange Str',
'Marktplatz', 'Amalias Street')) +
scale_y_continuous(name = 'Pedestrian crossing rate', limits=c(0,1.5)) +
scale_fill_brewer(palette = 'Pastel2')+ theme_bw() + theme(legend.position = "none")
p22<-ggplot(traf, aes(x=as.factor(case), y = comply, fill=case)) + geom_boxplot() +
geom_point(size = 0.9, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_x_discrete(name = 'Case', labels = c('Frankfurter Str', 'Lange Str',
'Marktplatz', 'Amalias Street')) +
scale_y_continuous(name = 'Speed compliance rate') +
scale_fill_brewer(palette = 'Pastel2')+ theme_bw() + theme(legend.position = "none")
p1<-ggplot(traf, aes(y=pedcross, x=dflow, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_linetype_manual(values=c('solid','dashed','dotted','dotdash')) +
scale_y_continuous(name = 'Pedestrian crossing rate') +
scale_x_continuous(name = 'Deviation of vehicle flow in veh/h')
p2<-ggplot(traf, aes(y=pedcross, x=dped, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_linetype_manual(values=c('solid','dashed','dotted','dotdash')) +
scale_y_continuous(name = 'Pedestrian crossing rate') +
scale_x_continuous(name = 'Deviation of pedestrian flow in ped/h')
p3<-ggplot(traf, aes(y=comply, x=dflow, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_y_continuous(name = 'Speed Compliance rate') +
scale_x_continuous(name = 'Deviation of vehicle flow in veh/h')
p4<-ggplot(traf, aes(y=comply, x=dped, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_y_continuous(name = 'Speed Compliance rate') +
scale_x_continuous(name = 'Deviation of pedestrian flow in ped/h')
ggarrange(p11, p22, p1, p3, p2, p4, ncol=2, nrow=3, common.legend = TRUE, legend="bottom")
p11<-ggplot(traf, aes(x=as.factor(case), y = pedcross, fill=case)) + geom_boxplot() +
geom_point(size = 0.9, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_x_discrete(name = 'Case', labels = c('Frankfurter Str', 'Lange Str',
'Marktplatz', 'Amalias Street')) +
scale_y_continuous(name = 'Pedestrian crossing rate', limits=c(0,1.5)) +
scale_fill_brewer(palette = 'Pastel2')+ theme_bw() + theme(legend.position = "none")
p22<-ggplot(traf, aes(x=as.factor(case), y = comply, fill=case)) + geom_boxplot() +
geom_point(size = 0.9, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_x_discrete(name = 'Case', labels = c('Frankfurter Str', 'Lange Str',
'Marktplatz', 'Amalias Street')) +
scale_y_continuous(name = 'Speed compliance rate') +
scale_fill_brewer(palette = 'Pastel2')+ theme_bw() + theme(legend.position = "none")
p1<-ggplot(traf, aes(y=pedcross, x=dflow, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_linetype_manual(values=c('solid','dashed','dotted','dotdash')) +
scale_y_continuous(name = 'Pedestrian crossing rate') +
scale_x_continuous(name = 'Deviation of vehicle flow in veh/h')
p2<-ggplot(traf, aes(y=pedcross, x=dped, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_linetype_manual(values=c('solid','dashed','dotted','dotdash')) +
scale_y_continuous(name = 'Pedestrian crossing rate') +
scale_x_continuous(name = 'Deviation of pedestrian flow in ped/h')
p3<-ggplot(traf, aes(y=comply, x=dflow, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_y_continuous(name = 'Speed Compliance rate') +
scale_x_continuous(name = 'Deviation of vehicle flow in veh/h')
p4<-ggplot(traf, aes(y=comply, x=dped, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_y_continuous(name = 'Speed Compliance rate') +
scale_x_continuous(name = 'Deviation of pedestrian flow in ped/h')
ggarrange(p11, p22, p1, p3, p2, p4, ncol=2, nrow=3, common.legend = TRUE, legend="bottom")
traf$totspace <- (traf$minsafe + traf$maxact + traf$circ)
#traf$totspace <- (traf$minsafe + traf$maxact + traf$circ)
#traf$shvehspace <- traf$circ/traf$totspace
#traf$shpedspace <- 1 - traf$shvehspace
# A. descriptive statistics..!
describe(subset(traf, case=='fsbr')$speed)
describe(subset(traf, case=='lsho')$speed)
describe(subset(traf, case=='mke')$speed)
describe(subset(traf, case=='shnaf')$speed)
#describe(subset(traf, case=='fsbr')$shpedspace)
#describe(subset(traf, case=='lsho')$shpedspace)
#describe(subset(traf, case=='mke')$shpedspace)
#describe(subset(traf, case=='shnaf')$shpedspace)
describe(subset(traf, case=='fsbr')$ped/30)
describe(subset(traf, case=='lsho')$ped/30)
describe(subset(traf, case=='mke')$ped/30)
describe(subset(traf, case=='shnaf')$ped/30)
describe(subset(traf, case=='fsbr')$flow/30)
describe(subset(traf, case=='lsho')$flow/30)
describe(subset(traf, case=='mke')$flow/30)
describe(subset(traf, case=='shnaf')$flow/30)
describe(subset(traf, case=='fsbr')$cross/30)
describe(subset(traf, case=='lsho')$cross/30)
describe(subset(traf, case=='mke')$cross/30)
describe(subset(traf, case=='shnaf')$cross/30)
#describe(subset(traf, case=='fsbr')$shped)
#describe(subset(traf, case=='lsho')$shped)
#describe(subset(traf, case=='mke')$shped)
#describe(subset(traf, case=='shnaf')$shped)
describe(subset(traf, case=='fsbr')$pedcross)
corr(select(traf, c('shcirc', 'shmaxact', 'shminsafe',
'dflow', 'dped', 'dspeed', 'pedcross', 'comply')), 0.95, 'kendall')
shapiro.test(traf$ped/30) # no normality
shapiro.test(traf$flow/30) # no normality
shapiro.test(traf$lspeed) # no normality
shapiro.test(traf$dspeed) # no normality
shapiro.test(traf$pedcross) # no normality
timeplot<-function(df,street,text){ # time series plot, relationship between dspeed, lspeed, pedcross
p<-ggplot(subset(df, case==street)) +
geom_line(aes(x = 1:nrow(subset(df, case==street)), y = dspeed, color = 'Deviation from mean traffic speed'), size=0.75, linetype='solid') +
# geom_line(aes(x = 1:nrow(subset(df, case==street)), y = comply*20-0.25, color = 'Deviation from speed limit'), size=0.6) +
geom_line(aes(x = 1:nrow(subset(df, case==street)), y = (pedcross*20) - 6, color = 'Crossings per pedestrian'), size=0.75) +
scale_color_manual(name = '', values = c('Deviation from mean traffic speed'='red',
#'Deviation from speed limit'='black',
'Crossings per pedestrian'='blue2')) +
scale_x_continuous(name = 'Two minutes intervals', limits = c(0,105), breaks=seq(0,nrow(subset(df, case==street)),5)) +
scale_y_continuous(name = 'Speed deviations in km/h', limits = c(-25,25),
sec.axis = sec_axis( trans=~ (./20) + 0.3, name="Pedestrian crossing rate")) +
ggtitle(text) + theme_bw() + theme(legend.position="bottom")
return(p)}
p100<-ggarrange(timeplot(traf,'fsbr','Frankfurter Street, Bad Rothenfelde, Germany'),
timeplot(traf,'lsho','Lange Street, Hessisch Oldendorf, Germany'),
timeplot(traf,'mke','Marktplatz, Konigslutter am Elm, Germany'),
timeplot(traf,'shnaf','Amalias Street, Nafplio, Greece'), ncol=1, nrow=4,
common.legend = TRUE, legend="bottom")
p101<-ggplot(traf, aes(y=dspeed, x=as.factor(cross/30))) +
geom_boxplot(fill = "cadetblue1") + theme_bw() +
geom_point(size = 1.5, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_y_continuous(name ="Speed deviation in km/h") +
scale_x_discrete(name ="Pedestrian crossing in ped/2 minutes")
p100<-ggarrange(timeplot(traf,'fsbr','Frankfurter Street, Bad Rothenfelde, Germany'),
timeplot(traf,'lsho','Lange Street, Hessisch Oldendorf, Germany'),
timeplot(traf,'mke','Marktplatz, Konigslutter am Elm, Germany'),
timeplot(traf,'shnaf','Amalias Street, Nafplio, Greece'), ncol=1, nrow=4,
common.legend = TRUE, legend="bottom")
p101<-ggplot(traf, aes(y=dspeed, x=as.factor(cross/30))) +
geom_boxplot(fill = "cadetblue1") + theme_bw() +
geom_point(size = 1.5, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_y_continuous(name ="Speed deviation in km/h") +
scale_x_discrete(name ="Pedestrian crossing in ped/2 minutes")
ggarrange(p101, p100, ncol = 2)
p11<-ggplot(traf, aes(x=as.factor(case), y = pedcross, fill=case)) + geom_boxplot() +
geom_point(size = 0.9, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_x_discrete(name = 'Case', labels = c('Frankfurter Str', 'Lange Str',
'Marktplatz', 'Amalias Street')) +
scale_y_continuous(name = 'Pedestrian crossing rate', limits=c(0,1.5)) +
scale_fill_brewer(palette = 'Pastel2')+ theme_bw() + theme(legend.position = "none")
p22<-ggplot(traf, aes(x=as.factor(case), y = comply, fill=case)) + geom_boxplot() +
geom_point(size = 0.9, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_x_discrete(name = 'Case', labels = c('Frankfurter Str', 'Lange Str',
'Marktplatz', 'Amalias Street')) +
scale_y_continuous(name = 'Speed compliance rate') +
scale_fill_brewer(palette = 'Pastel2')+ theme_bw() + theme(legend.position = "none")
p1<-ggplot(traf, aes(y=pedcross, x=dflow, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_linetype_manual(values=c('solid','dashed','dotted','dotdash')) +
scale_y_continuous(name = 'Pedestrian crossing rate') +
scale_x_continuous(name = 'Deviation of vehicle flow in veh/h')
p2<-ggplot(traf, aes(y=pedcross, x=dped, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_linetype_manual(values=c('solid','dashed','dotted','dotdash')) +
scale_y_continuous(name = 'Pedestrian crossing rate') +
scale_x_continuous(name = 'Deviation of pedestrian flow in ped/h')
p3<-ggplot(traf, aes(y=comply, x=dflow, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_y_continuous(name = 'Speed Compliance rate') +
scale_x_continuous(name = 'Deviation of vehicle flow in veh/h')
p4<-ggplot(traf, aes(y=comply, x=dped, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_y_continuous(name = 'Speed Compliance rate') +
scale_x_continuous(name = 'Deviation of pedestrian flow in ped/h')
ggarrange(p11, p22, p1, p3, p2, p4, ncol=2, nrow=3, common.legend = TRUE, legend="bottom")
traf<-datafr_fun(gerdat,'fsbr', 'dats1', 20) # fsbr 20 km/h
traf<-rbind(traf, datafr_fun(gerdat,'lsho', 'dats1', 10)) # 10 km/h
traf<-rbind(traf, datafr_fun(gerdat,'mke', 'dats1', 20)) # 20 km/h
traf<-rbind(traf, datafr_fun(eldat,'shnaf','dats2', 30)) # # 30 km/h
traf$comply<-replace(traf$comply, traf$comply==0, 1)
# CORRELATIONS
corr<-function(df, x, m){ # plot correlation table funntion
corel = df
M = cor(corel)
testRes=cor.mtest(corel, conf.level=x, method = m)
corrplot(M, method = 'number', p.mat = testRes$p, sig.level = 1-x, diag=FALSE)}
traf$pedcross<-traf$cross/traf$ped # pedestrian crossings per pedestrian (relative number)
traf$circ<-ifelse(traf$case == 'fsbr', 6, ifelse(traf$case == 'lsho', 5,
ifelse(traf$case == 'mke', 6,
ifelse(traf$case == 'shnaf', 4.5, 0))))
traf$minsafe<-ifelse(traf$case == 'fsbr', 0, ifelse(traf$case == 'lsho', 3,
ifelse(traf$case == 'mke', 3.5,
ifelse(traf$case == 'shnaf', 6, 0))))
traf$maxsafe<-ifelse(traf$case == 'fsbr', 7, ifelse(traf$case == 'lsho', 6,
ifelse(traf$case == 'mke', 3.5,
ifelse(traf$case == 'shnaf', 6, 0))))
traf$minact<-ifelse(traf$case == 'fsbr', 0, ifelse(traf$case == 'lsho', 0,
ifelse(traf$case == 'mke', 14,
ifelse(traf$case == 'shnaf', 6.5, 0))))
traf$maxact<-ifelse(traf$case == 'fsbr', 7, ifelse(traf$case == 'lsho', 3,
ifelse(traf$case == 'mke', 14,
ifelse(traf$case == 'shnaf', 6.5, 0))))
# A. descriptive statistics..!
describe(subset(traf, case=='fsbr')$speed)
describe(subset(traf, case=='lsho')$speed)
describe(subset(traf, case=='mke')$speed)
describe(subset(traf, case=='shnaf')$speed)
describe(subset(traf, case=='fsbr')$ped/30)
describe(subset(traf, case=='lsho')$ped/30)
describe(subset(traf, case=='mke')$ped/30)
describe(subset(traf, case=='shnaf')$ped/30)
describe(subset(traf, case=='fsbr')$flow/30)
describe(subset(traf, case=='lsho')$flow/30)
describe(subset(traf, case=='mke')$flow/30)
describe(subset(traf, case=='shnaf')$flow/30)
describe(subset(traf, case=='fsbr')$cross/30)
describe(subset(traf, case=='lsho')$cross/30)
describe(subset(traf, case=='mke')$cross/30)
describe(subset(traf, case=='shnaf')$cross/30)
describe(subset(traf, case=='fsbr')$pedcross)
describe(subset(traf, case=='lsho')$pedcross)
describe(subset(traf, case=='mke')$pedcross)
describe(subset(traf, case=='shnaf')$pedcross)
describe(subset(traf, case=='fsbr')$dspeed)
describe(subset(traf, case=='lsho')$dspeed)
describe(subset(traf, case=='mke')$dspeed)
describe(subset(traf, case=='shnaf')$dspeed)
describe(subset(traf, case=='fsbr')$comply)
describe(subset(traf, case=='lsho')$comply)
describe(subset(traf, case=='mke')$comply)
describe(subset(traf, case=='shnaf')$comply)
corr(select(traf, c('shcirc', 'shmaxact', 'shminsafe',
'dflow', 'dped', 'dspeed', 'pedcross', 'comply')), 0.95, 'kendall')
shapiro.test(traf$ped/30) # no normality
shapiro.test(traf$flow/30) # no normality
shapiro.test(traf$lspeed) # no normality
shapiro.test(traf$dspeed) # no normality
shapiro.test(traf$pedcross) # no normality
timeplot<-function(df,street,text){ # time series plot, relationship between dspeed, lspeed, pedcross
p<-ggplot(subset(df, case==street)) +
geom_line(aes(x = 1:nrow(subset(df, case==street)), y = dspeed, color = 'Deviation from mean traffic speed'), size=0.75, linetype='solid') +
# geom_line(aes(x = 1:nrow(subset(df, case==street)), y = comply*20-0.25, color = 'Deviation from speed limit'), size=0.6) +
geom_line(aes(x = 1:nrow(subset(df, case==street)), y = (pedcross*20) - 6, color = 'Crossings per pedestrian'), size=0.75) +
scale_color_manual(name = '', values = c('Deviation from mean traffic speed'='red',
#'Deviation from speed limit'='black',
'Crossings per pedestrian'='blue2')) +
scale_x_continuous(name = 'Two minutes intervals', limits = c(0,105), breaks=seq(0,nrow(subset(df, case==street)),5)) +
scale_y_continuous(name = 'Speed deviations in km/h', limits = c(-25,25),
sec.axis = sec_axis( trans=~ (./20) + 0.3, name="Pedestrian crossing rate")) +
ggtitle(text) + theme_bw() + theme(legend.position="bottom")
return(p)}
p100<-ggarrange(timeplot(traf,'fsbr','Frankfurter Street, Bad Rothenfelde, Germany'),
timeplot(traf,'lsho','Lange Street, Hessisch Oldendorf, Germany'),
timeplot(traf,'mke','Marktplatz, Konigslutter am Elm, Germany'),
timeplot(traf,'shnaf','Amalias Street, Nafplio, Greece'), ncol=1, nrow=4,
common.legend = TRUE, legend="bottom")
p101<-ggplot(traf, aes(y=dspeed, x=as.factor(cross/30))) +
geom_boxplot(fill = "cadetblue1") + theme_bw() +
geom_point(size = 1.5, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_y_continuous(name ="Speed deviation in km/h") +
scale_x_discrete(name ="Pedestrian crossing in ped/2 minutes")
ggarrange(p101, p100, ncol = 2)
p11<-ggplot(traf, aes(x=as.factor(case), y = pedcross, fill=case)) + geom_boxplot() +
geom_point(size = 0.9, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_x_discrete(name = 'Case', labels = c('Frankfurter Str', 'Lange Str',
'Marktplatz', 'Amalias Street')) +
scale_y_continuous(name = 'Pedestrian crossing rate', limits=c(0,1.5)) +
scale_fill_brewer(palette = 'Pastel2')+ theme_bw() + theme(legend.position = "none")
p22<-ggplot(traf, aes(x=as.factor(case), y = comply, fill=case)) + geom_boxplot() +
geom_point(size = 0.9, alpha = .3, position = position_jitter(seed = 1, width = .2)) +
scale_x_discrete(name = 'Case', labels = c('Frankfurter Str', 'Lange Str',
'Marktplatz', 'Amalias Street')) +
scale_y_continuous(name = 'Speed compliance rate') +
scale_fill_brewer(palette = 'Pastel2')+ theme_bw() + theme(legend.position = "none")
p1<-ggplot(traf, aes(y=pedcross, x=dflow, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_linetype_manual(values=c('solid','dashed','dotted','dotdash')) +
scale_y_continuous(name = 'Pedestrian crossing rate') +
scale_x_continuous(name = 'Deviation of vehicle flow in veh/h')
p2<-ggplot(traf, aes(y=pedcross, x=dped, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_linetype_manual(values=c('solid','dashed','dotted','dotdash')) +
scale_y_continuous(name = 'Pedestrian crossing rate') +
scale_x_continuous(name = 'Deviation of pedestrian flow in ped/h')
p3<-ggplot(traf, aes(y=comply, x=dflow, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_y_continuous(name = 'Speed Compliance rate') +
scale_x_continuous(name = 'Deviation of vehicle flow in veh/h')
p4<-ggplot(traf, aes(y=comply, x=dped, color=case))+ geom_point(size = 0.90)+ theme_bw() +
scale_color_brewer(palette = 'Dark2') +
geom_smooth(method='lm', aes(group=case, color=case), size=1, alpha=0.2) +
scale_y_continuous(name = 'Speed Compliance rate') +
scale_x_continuous(name = 'Deviation of pedestrian flow in ped/h')
ggarrange(p11, p22, p1, p3, p2, p4, ncol=2, nrow=3, common.legend = TRUE, legend="bottom")
ggarrange(p11, p22, p1, p3, p2, p4, ncol=2, nrow=3, common.legend = TRUE, legend="bottom")
ggarrange(p11, p22, p1, p3, p2, p4, ncol=2, nrow=3, common.legend = TRUE, legend="bottom")
# HOT HOT HOT HOT FINALLY
traf$pedcross2<-1/exp(traf$pedcross)
traf$dflow2 <- traf$dflow/100
traf$dped2 <- traf$dped/100
model77<-lm(pedcross2 ~ dflow2 + dped + shcirc + shminsafe, data = traf[-c(228, 226, 196, 70, 31, 59, 46),])
View(model77)
View(model88)
model88<-lm(comply ~ dflow2 + dped2 + shcirc + shminsafe, data = traf[-c(250, 170, 157),])
traf$totspace <- (traf$minsafe + traf$maxact + traf$circ)
traf$shminsafe<-traf$minsafe/traf$totspace
traf$shmaxact<- traf$maxact/traf$totspace
traf$shcirc<- traf$circ/traf$totspace
model88<-lm(comply ~ dflow2 + dped2 + shcirc + shminsafe, data = traf[-c(250, 170, 157),])
summary(model88)
1/log(0.1226)
1/exp(0.1226)
model77<-lm(pedcross2 ~ dflow2 + dped + shcirc + shminsafe, data = traf[-c(228, 226, 196, 70, 31, 59, 46),])
model77<-lm(pedcross2 ~ dflow2 + dped + shcirc + shminsafe, data = traf[-c(228, 226, 196, 70, 31, 59, 46),])
-log(0.1226)
log(1/0.1226)
model77<-lm(pedcross2 ~ dflow2 + dped + shcirc + shminsafe, data = traf[-c(228, 226, 196, 70, 31, 59, 46),])
-lsummary(model77)
model77<-lm(pedcross2 ~ dflow2 + dped + shcirc + shminsafe, data = traf[-c(228, 226, 196, 70, 31, 59, 46),])
ols_vif_tol(model77)
gvlma(model77)
summary(model77)
log(1/b0)
log(1/0.6331)
